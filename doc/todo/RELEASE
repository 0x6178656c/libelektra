This describes what to do for a release:

= TODO =

- make sure no TODO is in this file (resolve them first!)
- Check transitions in plugin status: especially from/to experimental
- Check if Elektra builds, installs and works on freshly installed OS

== Testing ==

- fuzz checker
- memleaks
- ASAN


= Tasks before Release =

== Updates ==

- Update doc/COMPILE.md to reflect actually tested setups
- Write release notes

== Increment Version Number ==

- CMakeLists.txt
- Change VERSION variable in build-server

== Check ==

- https://build.libelektra.org/job/libelektra/job/master/ must pass
- Trigger release pipeline with dry run
- Inspect the logs from the pipeline
  - [ ] Error logs (*.error) must be empty
  - [ ] Check in the (test-*) folders if all tests passed
  - [ ] Check if version is correct in the version file
  - [ ] Check if the debian package build log was successfull (debian/<DEBIAN_CODENAME>/elektra_*.buildinfo)
- Check if all artifacts are present
  - [ ] Check debian/<DEBIAN_CODENAME> if all debian packages were built
  - [ ] Unarchive the elektra tarball and briefly verify if the correct version was archived
- Inspect the changes to the libelektra git repository (*.bundle)
  Inspect the git log of the master and debian branch with: git log -p --author="jenkins-release"
  Master:
  - [ ] Check diff of commit "Regenerate dot of plugins for release <VERSION>" and if 
        doc/images/plugins.pdf was generated correctly (Only if plugins were modified)
  - [ ] Check diff of commit "Update contract for release <VERSION>": Plugin tags in the plugin 
        README.md should be sorted (Only if tags are not sorted)
  Debian:
  - [ ] Check if master is merged to debian branch (commit: "merge <VERSION>")
  - [ ] Check diff of commit "Debian Package <VERSION>-1 (UNRELEASED)":
        An entry for a new upstream version should have been created in debian/changelog
  - [ ] Check diff of commit "Debian Package <VERSION>-1":
        The previously created version entry in debian/changelog should have been updated from
        UNRELEASED to unstable. 
- Inspect the changes to the docu git repository (docu.bundle)
  - [ ] Check diff of the latest commit "<VERSION> release" with: git log -p 
- Inspect the website from the pipeline

== Preperation ==

- Finalize release notes without hash sums (move to final name, add links where to download release)
- cp doc/todo/NEWS.md doc/news/_preparation_next_release.md

= Publish =

- Trigger release pipeline without dry run
- Add hash sums to release notes and run linkchecker to verify that all download links are working:
  mkdir build && cd build && make html && ../scripts/link-checker external-links.txt
- (Possible) rebuilds from website for last changes in the release notes

== Preperation for next release == 

- Increment CMPVERSION in scripts/build/run_icheck 
- Cleanup tests/icheck.suppression (and add info to release notes)
- Increment version in output of doc/tutorials/hello-elektra.md
- Increment <Version> of libelektra4j in examples/external/java/read-keys-example/pom.xml and src/bindings/jna/README.md

== Update Alpine Linux image on docker hub ==

Now that the release is available to download, rebuild the Alpine release image.

To do so, increment the Elektra version in e.g. `scripts/docker/alpine/3.12/release.Dockerfile`:
```
ELEKTRA_RELEASE=0.9.2
```
If the file does not exist, possibly the Alpine version was changed.

== Announce ==

send out release mails&post on social media (see github issue #676)
